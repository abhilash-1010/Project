<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CampusBay - Buy & Sell on Campus</title>

    <!-- 
      =======================================================================
      INLINE CSS
      =======================================================================
    -->
    <style>
        /* --- Global & Theme --- */
        :root {
            --primary-color: #FF9933; /* Saffron/Orange */
            --secondary-color: #138808; /* Green */
            --bg-color: #FFFBF5; /* Light, warm peach background */
            --card-bg: #ffffff;
            --text-color: #2c3e50; /* Softer dark blue/black */
            --border-color: #e6e6e6; /* Lighter border */
            --error-color: #d93025;
            --header-height: 60px;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
            background-color: var(--bg-color); 
            color: var(--text-color);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        /* --- Header --- */
        .header {
            background-color: var(--card-bg);
            border-bottom: 1px solid var(--border-color);
            padding: 0 1rem;
            height: var(--header-height);
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 999;
            box-shadow: 0 2px 6px rgba(0,0,0,0.06); 
        }

        .header-logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
            text-decoration: none;
        }

        .header-search {
            flex-grow: 1;
            margin: 0 1.5rem;
            max-width: 500px;
        }

        .header-search input {
            width: 100%;
            padding: 0.6rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: 20px;
            font-size: 1rem;
        }

        .header-nav button {
            font-size: 0.9rem;
            font-weight: 600;
            padding: 0.6rem 1rem;
            border-radius: 5px;
            border: none;
            cursor: pointer;
            margin-left: 0.5rem;
            transition: background-color 0.2s;
        }
        
        /* Nav States */
        #nav-logged-in {
            display: none; /* Hidden by default */
            align-items: center;
        }
        #nav-logged-out {
            display: flex;
            align-items: center;
        }
        #welcome-msg {
            font-size: 0.9rem;
            color: var(--text-color);
            margin-right: 1rem;
            white-space: nowrap; /* Keep name on one line */
        }


        .btn {
            font-size: 0.9rem;
            font-weight: 600;
            padding: 0.6rem 1rem;
            border-radius: 5px;
            border: none;
            cursor: pointer;
            transition: background-color 0.2s, opacity 0.2s, border-color 0.2s, color 0.2s;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }
        .btn-primary:hover {
            opacity: 0.9;
        }

        .btn-secondary {
            background-color: var(--card-bg);
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
        }
        .btn-secondary:hover {
            background-color: #fffaf0;
        }

        .btn-success {
            background-color: var(--secondary-color);
            color: white;
            border: 1px solid var(--secondary-color);
            cursor: default;
        }
        .btn-success:hover {
            opacity: 1;
        }

        .btn-demo {
            background-color: var(--secondary-color); /* Green */
            color: white;
            border: none;
            width: 100%;
            padding: 0.75rem;
            font-size: 1rem;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 1rem;
            font-weight: 600;
        }
        .btn-demo:hover {
            opacity: 0.9;
        }


        /* --- Main Content Layout --- */
        .main-content {
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 1.5rem;
            padding-top: 1.5rem;
        }

        /* --- Filters Sidebar --- */
        .filters {
            background-color: var(--card-bg);
            padding: 1rem;
            border-radius: 8px;
            height: fit-content;
            position: sticky;
            top: calc(var(--header-height) + 1.5rem);
            border: 1px solid #f0e9e0; /* Subtle border */
        }

        .filter-group {
            margin-bottom: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 1rem;
        }
        .filter-group:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .filter-group h3 {
            font-size: 1.1rem;
            margin-bottom: 0.75rem;
        }

        .filter-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            cursor: pointer;
        }
        .filter-group input[type="checkbox"] {
            margin-right: 0.5rem;
        }
        .filter-group input[type="text"],
        .filter-group input[type="number"] {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            margin-top: 0.25rem;
        }
        .price-filter {
            display: flex;
            gap: 0.5rem;
        }

        /* --- Listings Grid --- */
        .listings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            gap: 1rem;
            min-height: 200px; /* For "No listings" message */
        }

        .listing-card {
            background-color: var(--card-bg);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05); 
            transition: box-shadow 0.3s ease, transform 0.3s ease;
            display: flex;
            flex-direction: column;
            border: 1px solid #f0e9e0; 
            cursor: pointer; 
        }
        .listing-card:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transform: translateY(-5px);
        }

        .listing-card-image {
            width: 100%;
            height: 160px;
            background-color: #eee;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #aaa;
            font-size: 0.9rem;
            text-align: center;
            padding: 0.5rem;
        }
        .listing-card-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .listing-card-content {
            padding: 1rem;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .listing-card-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;  
            overflow: hidden;
        }

        .listing-card-price {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--secondary-color);
            margin-bottom: 0.25rem;
        }

        .listing-card-location {
            font-size: 0.8rem;
            color: #666;
            margin-bottom: 0.75rem;
        }

        .listing-card-action {
            margin-top: auto;
        }

        .listing-card-action .btn-primary {
            width: 100%;
        }

        .no-listings-message {
            color: #777;
            font-style: italic;
            grid-column: 1 / -1; /* Span all columns */
            text-align: center;
            margin-top: 2rem;
        }

        /* --- Footer --- */
        .footer {
            margin-top: 2rem;
            padding: 2rem 1rem;
            background-color: #333;
            color: #f4f4f4;
            text-align: center;
        }
        .footer-links {
            margin-bottom: 1rem;
        }
        .footer-links a {
            color: var(--primary-color);
            margin: 0 0.75rem;
            text-decoration: none;
        }
        .footer-links a:hover {
            text-decoration: underline;
        }

        /* --- Modal --- */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.6);
            animation: fadeIn 0.3s;
        }

        .modal-content {
            background-color: #fefefe;
            margin: 10vh auto;
            padding: 0; 
            border: 1px solid #888;
            border-radius: 8px;
            width: 90%;
            max-width: 600px; 
            position: relative;
            animation: slideIn 0.3s;
            overflow: hidden; 
        }
        
        .modal-content-small {
            max-width: 500px;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
            padding: 1rem 1.5rem;
            margin-bottom: 0;
        }

        .modal-header h2 {
            color: var(--primary-color);
            font-size: 1.4rem;
        }
        
        .modal-body {
            padding: 1.5rem;
            /* Set max height for scrollable modal bodies */
            max-height: 60vh;
            overflow-y: auto;
        }

        .modal-close-btn {
            color: #aaa;
            font-size: 2rem;
            font-weight: bold;
            cursor: pointer;
            line-height: 1;
        }
        .modal-close-btn:hover {
            color: #333;
        }
        
        /* --- NEW: Auth (Login/Register) Modal Styles --- */
        .auth-tabs {
            display: flex;
            border-bottom: 1px solid var(--border-color);
        }
        .auth-tab {
            width: 50%;
            padding: 1rem;
            text-align: center;
            font-weight: 600;
            cursor: pointer;
            background: #f9f9f9;
            color: #777;
            border-bottom: 3px solid transparent;
        }
        .auth-tab.active {
            color: var(--primary-color);
            background: var(--card-bg);
            border-bottom-color: var(--primary-color);
        }
        
        .auth-form-container {
            display: none; /* Hide both forms by default */
        }
        .auth-form-container.active {
            display: block; /* Show only the active one */
        }


        /* Modal Form Styles */
        .form-group {
            margin-bottom: 1rem;
        }
        .form-group label {
            display: block;
            margin-bottom: 0.25rem;
            font-weight: 600;
        }
        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            font-size: 1rem;
            font-family: inherit;
        }
        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .form-error {
            color: var(--error-color);
            font-size: 0.9rem;
            margin-top: 1rem;
            text-align: center;
            display: none; 
        }

        /* --- Chat Modal Specifics --- */
        #chat-window {
            height: 300px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            margin-bottom: 1rem;
            padding: 1rem;
            overflow-y: auto;
            background: #f9f9f9;
            display: flex;
            flex-direction: column;
        }
        .msg {
            padding: 0.5rem 0.75rem;
            border-radius: 10px;
            margin-bottom: 0.5rem;
            max-width: 80%;
            line-height: 1.4;
        }
        .msg-seller {
            background: #e9e9e9;
            border-radius: 10px 10px 10px 0;
            align-self: flex-start;
        }
        .msg-buyer {
            background: #ffe8cc;
            border-radius: 10px 10px 0 10px;
            align-self: flex-end;
        }
        #chat-form {
            display: flex;
            gap: 0.5rem;
        }
        #chat-form input {
            flex-grow: 1;
        }

        /* --- Listing Detail Modal Styles --- */
        #detail-modal-image {
            width: 100%;
            height: 300px;
            background-color: #eee;
        }
        #detail-modal-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        #detail-modal-price {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--secondary-color);
            margin-bottom: 0.5rem;
        }
        #detail-modal-location {
            font-size: 0.9rem;
            color: #777;
            margin-bottom: 1rem;
        }
        #detail-modal-description {
            font-size: 1rem;
            line-height: 1.7;
            margin-bottom: 1.5rem;
            border-top: 1px solid var(--border-color);
            padding-top: 1rem;
        }
        #detail-modal-seller-card {
            background-color: #f9f9f9;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
        }
        #detail-modal-seller-card span {
            font-weight: 600;
            margin-left: 0.75rem;
        }
        #detail-modal-actions {
            display: flex;
            gap: 0.75rem;
        }

        /* --- Saved Items Modal Styles --- */
        #saved-items-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
        }
        .saved-item-card {
            display: flex;
            align-items: center;
            background: #fdfdfd;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 0.75rem;
            gap: 1rem;
        }
        .saved-item-img {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 5px;
            background: #eee;
        }
        .saved-item-info {
            flex-grow: 1;
        }
        .saved-item-title {
            font-weight: 600;
        }
        .saved-item-price {
            font-size: 0.9rem;
            color: var(--secondary-color);
            font-weight: 700;
        }
        .saved-item-empty {
            text-align: center;
            color: #777;
            padding: 2rem 0;
        }


        /* --- Toast Notification Style --- */
        #toast {
            display: none; 
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #333;
            color: #fff;
            padding: 12px 20px;
            border-radius: 5px;
            z-index: 2000;
            font-size: 0.9rem;
            animation: fadeIn 0.5s, fadeOut 0.5s 2.5s;
        }
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }

        /* --- Responsive Design --- */
        @media (max-width: 992px) {
            .main-content {
                grid-template-columns: 220px 1fr;
            }
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            .filters {
                position: static;
                margin-bottom: 1.5rem;
            }
            .header-search {
                display: none; 
            }
            .header-nav button {
                padding: 0.5rem;
                font-size: 0.8rem;
            }
            .header-nav button:first-child {
                margin-left: 0.25rem;
            }
            #welcome-msg {
                display: none; 
            }
            #detail-modal-image {
                height: 200px; /* Smaller image on mobile */
            }
            .modal-content {
                margin: 5vh auto; /* Less top margin */
            }
        }
    </style>
</head>
<body>

    <!-- ======================= HEADER ======================= -->
    <header class="header">
        <!-- Logo now links back to landing page -->
        <a href="index.html" class="header-logo">CampusBay</a>
        
        <div class="header-search">
            <input type="search" id="search-input" placeholder="Search for textbooks, electronics, notes...">
        </div>
        
        <nav class="header-nav">
            <!-- Logged Out State -->
            <div id="nav-logged-out">
                <button class="btn btn-primary" id="create-listing-btn-logged-out">
                    &#43; Sell Item
                </button>
                <button class="btn btn-secondary" id="login-btn">Login / Register</button>
            </div>
            
            <!-- Logged In State -->
            <div id="nav-logged-in">
                <span id="welcome-msg">Welcome, ABHILASH ARYA!</span> 
                <button class="btn btn-secondary" id="saved-items-btn" style="margin-right: 10px;">&#9829; Saved (0)</button>
                <button class="btn btn-primary" id="create-listing-btn-logged-in">
                    &#43; Sell Item
                </button>
                <button class="btn btn-secondary" id="logout-btn">Logout</button>
            </div>

        </nav>
    </header>

    <!-- ======================= MAIN CONTENT (Filters + Grid) ======================= -->
    <main class="container main-content">
        
        <!-- --- FILTERS --- -->
        <aside class="filters">
            <div class="filter-group">
                <h3>Categories</h3>
                <label><input type="checkbox" class="category-filter" value="Books"> Books</label>
                <label><input type="checkbox" class="category-filter" value="Electronics"> Electronics</label>
                <label><input type="checkbox" class="category-filter" value="Fashion"> Fashion</label>
                <label><input type="checkbox" class="category-filter" value="Furniture"> Furniture</label>
                <label><input type="checkbox" class="category-filter" value="Stationery"> Stationery</label>
            </div>

            <div class="filter-group">
                <h3>Price Range (&#8377;)</h3>
                <div class="price-filter">
                    <input type="number" id="price-min" placeholder="Min">
                    <input type="number" id="price-max" placeholder="Max">
                </div>
            </div>

            <div class="filter-group">
                <h3>Location</h3>
                <label>Campus:</label>
                <input type="text" placeholder="e.g., BMSCE" value="BMSCE">
                <label>Hostel / Block:</label>
                <input type="text" placeholder="e.g., CSE Block">
            </div>

        </aside>

        <!-- --- LISTINGS --- -->
        <section class="listings-grid" id="listings-grid">
            <!-- Listings will be dynamically inserted here -->
        </section>

    </main>

    <!-- ======================= FOOTER ======================= -->
    <footer class="footer">
        <div class="footer-links">
            <a href="#">About</a>
            <a href="#">Terms</a>
            <a href="#">Privacy Policy</a>
            <a href="#">How It Works</a>
            <a href="#">Safety Tips</a>
        </div>
        <p>&copy; 2025 CampusBay. Made for students, by students.</p>
    </footer>


    <!-- =================================================================== -->
    <!--                       MODALS (Hidden by default)                    -->
    <!-- =================================================================== -->

    <!-- --- Login/Register Modal (COMBINED) --- -->
    <div id="login-modal" class="modal">
        <div class="modal-content modal-content-small">
            
            <div class="modal-header">
                <h2 id="auth-modal-title">Login</h2> <!-- Title will change with JS -->
                <span class="modal-close-btn" data-modal-id="login-modal">&times;</span>
            </div>

            <!-- NEW: Auth Tabs -->
            <div class="auth-tabs">
                <div class="auth-tab active" id="login-tab-btn">Login</div>
                <div class="auth-tab" id="register-tab-btn">Register</div>
            </div>
            
            <!-- Login Form Container -->
            <div class="auth-form-container active" id="login-form-container">
                <div class="modal-body">
                    <form id="login-form">
                        <div class="form-group">
                            <label for="email">Campus Email</label>
                            <input type="email" id="login-email" placeholder="e.g., abhilash@bmsce.ac.in" required>
                        </div>
                        <div class="form-group">
                            <label for="password">Password</label>
                            <input type="password" id="login-password" required>
                        </div>
                        <button type="submit" class="btn btn-primary" style="width:100%; padding: 0.75rem;">Login</button>
                        
                        <button type="button" class="btn-demo" id="demo-login-btn">
                            &#11088; Login as Demo
                        </button>

                        <p class="form-error" id="login-error-msg">Invalid credentials. Try a demo account.</p>
                        
                        <p style="text-align: center; margin-top: 1rem; font-size: 0.9rem;">
                            Demo accounts: <br>
                            <code style="background: #eee; padding: 2px 5px; border-radius: 4px;">abhilash@bmsce.ac.in</code> <br>
                            <code style="background: #eee; padding: 2px 5px; border-radius: 4px;">student@rvce.ac.in</code>
                        </p>
                    </form>
                </div>
            </div>

            <!-- NEW: Register Form Container -->
            <div class="auth-form-container" id="register-form-container">
                <div class="modal-body">
                    <form id="register-form">
                        <div class="form-group">
                            <label for="register-name">Full Name</label>
                            <input type="text" id="register-name" placeholder="e.g., Priya S." required>
                        </div>
                        <div class="form-group">
                            <label for="register-email">Campus Email</label>
                            <input type="email" id="register-email" placeholder="e.g., priya@bmsce.ac.in" required>
                        </div>
                        <div class="form-group">
                            <label for="register-password">Password</label>
                            <input type="password" id="register-password" required>
                        </div>
                        <div class="form-group">
                            <label for="register-confirm-password">Confirm Password</label>
                            <input type="password" id="register-confirm-password" required>
                        </div>

                        <button type="submit" class="btn btn-primary" style="width:100%; padding: 0.75rem;">Create Account</button>
                        
                        <p class="form-error" id="register-error-msg">Passwords do not match.</p>
                    </form>
                </div>
            </div>
        </div>
    </div>


    <!-- --- Create Listing Modal --- -->
    <div id="create-listing-modal" class="modal">
        <div class="modal-content modal-content-small">
            <div class="modal-header">
                <h2>Create New Listing</h2>
                <span class="modal-close-btn" data-modal-id="create-listing-modal">&times;</span>
            </div>
            <div class="modal-body">
                <form id="create-listing-form">
                    <div class="form-group">
                        <label for="listing-title">Title</label>
                        <input type="text" id="listing-title" placeholder="e.g., Engineering Data Structures Textbook" required>
                    </div>
                    <div class="form-group">
                        <label for="listing-price">Price (&#8377;)</label>
                        <input type="number" id="listing-price" placeholder="150" required>
                    </div>
                    <div class="form-group">
                        <label for="listing-category">Category</label>
                        <select id="listing-category" required>
                            <option value="">-- Select a category --</option>
                            <option value="Books">Books</option>
                            <option value="Electronics">Electronics</option>
                            <option value="Fashion">Fashion</option>
                            <option value="Furniture">Furniture</option>
                            <option value="Stationery">Stationery</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="listing-location">Pickup Location</label>
                        <input type="text" id="listing-location" placeholder="e.g., CSE Block, BMSCE" required>
                    </div>
                    <div class="form-group">
                        <label for="listing-description">Description</label>
                        <textarea id="listing-description" placeholder="Add details: condition, edition, etc."></textarea>
                    </div>
                     <div class="form-group">
                        <label for="images">Upload Images (Optional)</label>
                        <input type="file" id="images" multiple>
                        <small style="display:block; margin-top: 5px; color: #777;">This is for demo, images won't be saved.</small>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width:100%; padding: 0.75rem;">Post Your Listing</button>
                </form>
            </div>
        </div>
    </div>

    <!-- --- Chat Modal --- -->
    <div id="chat-modal" class="modal">
        <div class="modal-content modal-content-small">
            <div class="modal-header">
                <h2 id="chat-modal-title">Chat with Seller</h2>
                <span class="modal-close-btn" data-modal-id="chat-modal">&times;</span>
            </div>
            <div class="modal-body">
                <div id="chat-window">
                    <div class="msg msg-seller">Hi! Is this still available?</div>
                    <div class="msg msg-buyer">Yes, it is!</div>
                </div>
                <form id="chat-form">
                    <input type="text" id="chat-message-input" placeholder="Type your message..." required>
                    <button type="submit" class="btn btn-primary">Send</button>
                </form>
            </div>
        </div>
    </div>

    <!-- --- Listing Detail Modal --- -->
    <div id="listing-detail-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="detail-modal-title">Listing Details</h2>
                <span class="modal-close-btn" data-modal-id="listing-detail-modal">&times;</span>
            </div>
            
            <div id="detail-modal-image">
                <img src="" alt="Listing Image" id="detail-modal-img-src">
            </div>

            <div class="modal-body">
                <p id="detail-modal-price">&#8377;0</p>
                <p id="detail-modal-location">Location</p>
                <p id="detail-modal-description">Full description goes here.</p>

                <div id="detail-modal-seller-card">
                    <span style="font-size: 1.5rem;">&#128100;</span>
                    <!-- Seller name will be set by JS -->
                    <span id="detail-modal-seller-name">Seller: Name</span>
                </div>
                
                <div id="detail-modal-actions">
                    <button class="btn btn-primary" id="detail-modal-chat-btn">Message Seller</button>
                    <button class="btn btn-secondary" id="detail-modal-save-btn">Save for Later</button>
                </div>
            </div>
        </div>
    </div>

    <!-- --- Saved Items Modal --- -->
    <div id="saved-items-modal" class="modal">
        <div class="modal-content modal-content-small">
            <div class="modal-header">
                <h2>Your Saved Items</h2>
                <span class="modal-close-btn" data-modal-id="saved-items-modal">&times;</span>
            </div>
            <div class="modal-body">
                <div id="saved-items-grid">
                    <!-- Saved items will be injected here -->
                    <p class="saved-item-empty">You have no saved items.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast">Item saved!</div>


    <!-- 
      =======================================================================
      INLINE JAVASCRIPT
      =======================================================================
    -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- 0. STATE & DEMO DATA ---
            
            let isLoggedIn = false;
            let savedItems = new Set(); 
            
            const demoUsers = [
                { email: 'abhilash@bmsce.ac.in', name: 'ABHILASH ARYA' },
                { email: 'student@rvce.ac.in', name: 'Priya S.' },
                { email: 'test@pes.edu', name: 'Vikram Singh' }
            ];

            const listingsData = [
                {
                    id: 1,
                    title: "Engineering Data Structures Textbook (Used)",
                    price: 350,
                    category: "Books",
                    location: "CSE Block, BMSCE",
                    image: "https://engineeringbookstore.in/wp-content/uploads/2022/09/data-structure1-new.jpg",
                    description: "Data Structures and Algorithms textbook, 3rd Edition. Used for one semester. Some highlighting in chapters 2-5. No torn pages. Perfect for 2nd year CSE students.",
                    seller: "Rohan Gupta"
                },
                {
                    id: 2,
                    title: "boAt Rockerz 450 Headphones",
                    price: 800,
                    category: "Electronics",
                    location: "NGH 2",
                    image: "https://images.unsplash.com/photo-1739764574592-1dcd5d978a53?ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&q=80&w=942",
                    description: "1-year-old boAt Rockerz 450 wireless headphones. Good battery life, lasts for 8-10 hours. Earcup foam is slightly worn but perfectly usable. Comes with charging cable.",
                    seller: "Priya S."
                },
                {
                    id: 3,
                    title: "Men's Kurta (Medium, Like New)",
                    price: 500,
                    category: "Fashion",
                    location: "Himalaya Block",
                    image: "https://koranm.com/cdn/shop/articles/Exploring_Different_Types_of_Men_s_Kurta_Designs_and_How_to_Choose_the_Best_One.png?v=1712751935&width=1440",
                    description: "Cotton-silk blend kurta, size Medium. Worn only once for a college function. Dry-cleaned and in perfect, like-new condition. Bright blue color.",
                    seller: "Aman Sharma"
                },
                {
                    id: 4,
                    title: "SG Cricket Bat (Full Size)",
                    price: 1200,
                    category: "Stationery", 
                    location: "4th Cross Road, Jaynagar",
                    image: "https://plus.unsplash.com/premium_photo-1679690884082-eaba9eccdcb5?ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&q=80&w=784",
                    description: "SG Kashmir Willow cricket bat, full size (Short Handle). Used for one season of inter-hostel matches. Already knocked-in. Good for beginners and practice.",
                    seller: "Vikram Singh"
                },
                {
                    id: 5,
                    title: "Drafter / Mini-Drafter for Engineering",
                    price: 250,
                    category: "Stationery",
                    location: "Stationery Shop",
                    image: "https://m.media-amazon.com/images/I/81NWB9RoGuL.jpg",
                    description: "Standard mini-drafter for engineering drawing. Includes case and all original screws. No cracks or breaks. Works perfectly.",
                    seller: "Deepthi Arya"
                },
                {
                    id: 6,
                    title: "Study Table (Foldable)",
                    price: 600,
                    category: "Furniture",
                    location: "NGH 3 (Block 2)", 
                    image: "https://m.media-amazon.com/images/I/61Kia5ppDML._AC_UF894,1000_QL80_.jpg",
                    description: "Wooden top foldable study table. Perfect for small hostel rooms. Folds flat for easy storage under the bed. Minor scratches on the surface, but very sturdy.",
                    seller: "Riya Mehta"
                },
                {
                    id: 7,
                    title: "PS4 DualShock 4 Controller",
                    price: 5000,
                    category: "Electronics",
                    location: "NBH 7 (Block 1)", 
                    image: "https://m.media-amazon.com/images/I/71x2s-+HtPL.jpg",
                    description: "Original Sony PS4 controller. Black color. All buttons and analog sticks work perfectly. No stick drift. Selling because I upgraded to a PS5. Fixed price, no negotiation.",
                    seller: "Karan Verma"
                },
                {
                    id: 8,
                    title: "Calculus by Hari Kishan (11th Ed)",
                    price: 400,
                    category: "Books",
                    location: "Library",
                    image: "https://www.madrasshoppe.com/152328-large_default/calculus-hari-kishan.jpg",
                    description: "The classic Calculus textbook for 1st year engineering. 11th Edition. Good condition, no notes inside. Original price was 800+.",
                    seller: "Riya S."
                },
                {
                    id: 9,
                    title: "Backpack for Girls (25L)",
                    price: 750,
                    category: "Fashion",
                    location: "NGH 3 (New Girls Hostel)",
                    image: "https://images-cdn.ubuy.co.in/64b247adb5f4bf37692783ca-kebi-kids-backpack-for-girls-school.jpg",
                    description: "25L Wildcraft backpack in grey and orange. Has 3 compartments and a laptop sleeve. Zips are all working. Good for carrying books and laptop.",
                    seller: "Sneha Reddy"
                },
                 {
                    id: 10,
                    title: "HP Laptop Charger (65W)",
                    price: 900,
                    category: "Electronics",
                    location: "CSE Block, BMSCE",
                    image: "https://m.media-amazon.com/images/I/615N4L445SL._AC_UF1000,1000_QL80_.jpg",
                    description: "Original 65W HP laptop charger (blue pin). Bought a new laptop, so selling this spare one. Works perfectly. Please check your laptop's pin type before buying.",
                    seller: "Vikram Singh"
                }, 
                 {
                    id: 11,
                    title: "Set of 12 Classmate Notebooks",
                    price: 200,
                    category: "Stationery",
                    location: "Stationery Shop",
                    image: "https://static.wixstatic.com/media/e01753_85ddcd76ea3345fd927f3e5764f9f48c~mv2.png/v1/fill/w_476,h_476,al_c,lg_1,q_85,enc_avif,quality_auto/e01753_85ddcd76ea3345fd927f3e5764f9f48c~mv2.png",
                    description: "A full set of 12 brand new, un-used Classmate notebooks (180 pages, single line). Bought extra by mistake. Selling as a full set only.",
                    seller: "Rohan Gupta"
                },
                {
                    id: 12,
                    title: "Gaming Chair (Good Condition)",
                    price: 5600,
                    category: "Furniture",
                    location: "NBH 14 (Near Main Building)",
                    image: "https://th.bing.com/th/id/OIP.Gjb4GlNjv-55Jw56ohvblgHaHa?w=208&h=207&c=7&r=0&o=7&dpr=1.3&pid=1.7&rm=3",
                    description: "Black office chair with mesh back and adjustable height. Hydraulic lift works fine. Very comfortable for long study sessions. No tears in the seat.",
                    seller: "Kshitiz Mittal"
                }
            ];

            const listingsGrid = document.getElementById('listings-grid');
            const toast = document.getElementById('toast'); 
            
            // --- 1. RENDER FUNCTION ---
            function renderListings(listings) {
                listingsGrid.innerHTML = '';
                if (listings.length === 0) {
                    listingsGrid.innerHTML = '<p class="no-listings-message">No listings found matching your criteria. Try adjusting your filters!</p>';
                    return;
                }
                listings.forEach(listing => {
                    const card = `
                        <article class="listing-card" data-listing-id="${listing.id}">
                            <div class="listing-card-image">
                                <img src="${listing.image.replace('600x400', '400x300')}" alt="${listing.title}" onerror="this.parentElement.innerHTML = 'Image for ${listing.title}';">
                            </div>
                            <div class="listing-card-content">
                                <h3 class="listing-card-title">${listing.title}</h3>
                                <p class="listing-card-price">&#8377;${listing.price}</p>
                                <p class="listing-card-location">${listing.location}</p>
                                <div class="listing-card-action">
                                    <button class="btn btn-primary chat-btn">Message Seller</button>
                                </div>
                            </div>
                        </article>
                    `;
                    listingsGrid.innerHTML += card;
                });
            }

            // --- 2. FILTERING LOGIC ---
            const searchInput = document.getElementById('search-input');
            const priceMinInput = document.getElementById('price-min');
            const priceMaxInput = document.getElementById('price-max');
            const categoryCheckboxes = document.querySelectorAll('.category-filter');

            function applyFilters() {
                let filteredListings = [...listingsData];
                const searchTerm = searchInput.value.toLowerCase();
                if (searchTerm) {
                    filteredListings = filteredListings.filter(l => l.title.toLowerCase().includes(searchTerm) || l.location.toLowerCase().includes(searchTerm));
                }
                const minPrice = parseFloat(priceMinInput.value);
                const maxPrice = parseFloat(priceMaxInput.value);
                if (!isNaN(minPrice)) {
                    filteredListings = filteredListings.filter(l => l.price >= minPrice);
                }
                if (!isNaN(maxPrice)) {
                    filteredListings = filteredListings.filter(l => l.price <= maxPrice);
                }
                const checkedCategories = [];
                categoryCheckboxes.forEach(cb => { if (cb.checked) checkedCategories.push(cb.value); });
                if (checkedCategories.length > 0) {
                    filteredListings = filteredListings.filter(l => checkedCategories.includes(l.category));
                }
                renderListings(filteredListings);
            }

            searchInput.addEventListener('input', applyFilters);
            priceMinInput.addEventListener('input', applyFilters);
            priceMaxInput.addEventListener('input', applyFilters);
            categoryCheckboxes.forEach(cb => cb.addEventListener('change', applyFilters));

            // --- 3. MODAL HANDLING ---
            const modals = {
                login: document.getElementById('login-modal'),
                create: document.getElementById('create-listing-modal'),
                chat: document.getElementById('chat-modal'),
                detail: document.getElementById('listing-detail-modal'),
                saved: document.getElementById('saved-items-modal')
            };
            
            const detailTitle = document.getElementById('detail-modal-title');
            const detailImg = document.getElementById('detail-modal-img-src');
            const detailPrice = document.getElementById('detail-modal-price');
            const detailLocation = document.getElementById('detail-modal-location');
            const detailDescription = document.getElementById('detail-modal-description');
            const detailSellerName = document.getElementById('detail-modal-seller-name'); 
            const detailChatBtn = document.getElementById('detail-modal-chat-btn');
            const detailSaveBtn = document.getElementById('detail-modal-save-btn'); 

            function showDetailModal(listingId) {
                const listing = listingsData.find(l => l.id == listingId);
                if (!listing) return;

                detailTitle.innerText = listing.title;
                detailImg.src = listing.image;
                detailImg.alt = listing.title;
                detailPrice.innerHTML = `&#8377;${listing.price}`;
                detailLocation.innerText = listing.location;
                detailDescription.innerText = listing.description;
                detailSellerName.innerText = `Seller: ${listing.seller}`; 
                
                detailChatBtn.onclick = () => {
                    modals.detail.style.display = 'none'; 
                    showChatModal(listing.title); 
                };

                detailSaveBtn.dataset.listingId = listing.id;
                if (savedItems.has(listing.id)) {
                    detailSaveBtn.innerText = 'âœ“ Saved';
                    detailSaveBtn.classList.add('btn-success');
                    detailSaveBtn.classList.remove('btn-secondary');
                    detailSaveBtn.disabled = true;
                } else {
                    detailSaveBtn.innerText = 'Save for Later';
                    detailSaveBtn.classList.remove('btn-success');
                    detailSaveBtn.classList.add('btn-secondary');
                    detailSaveBtn.disabled = false;
                }

                modals.detail.style.display = 'block';
            }

            const chatModalTitle = document.getElementById('chat-modal-title');
            function showChatModal(title) {
                chatModalTitle.innerText = `Chat: ${title}`;
                modals.chat.style.display = 'block';
            }

            document.getElementById('login-btn').onclick = () => {
                modals.login.style.display = 'block';
            };
            document.getElementById('create-listing-btn-logged-out').onclick = () => {
                modals.login.style.display = 'block';
            };
            document.getElementById('create-listing-btn-logged-in').onclick = () => {
                modals.create.style.display = 'block';
            };

            listingsGrid.addEventListener('click', (e) => {
                const card = e.target.closest('.listing-card');
                if (!card) return; 

                const listingId = card.getAttribute('data-listing-id');

                if (e.target.classList.contains('chat-btn')) {
                    const title = card.querySelector('.listing-card-title').innerText;
                    showChatModal(title);
                } else {
                    showDetailModal(listingId);
                }
            });

            document.querySelectorAll('.modal-close-btn').forEach(btn => {
                btn.onclick = () => {
                    document.getElementById(btn.getAttribute('data-modal-id')).style.display = 'none';
                };
            });
            window.onclick = (e) => {
                if (e.target.classList.contains('modal')) e.target.style.display = 'none';
            };

            // --- 4. "CREATE LISTING" FORM ---
            const createListingForm = document.getElementById('create-listing-form');
            createListingForm.addEventListener('submit', (e) => {
                e.preventDefault();
                // Get the currently logged-in user's name
                const welcomeText = welcomeMsg.innerText.replace('Welcome, ', '').replace('!', '');
                const currentUser = demoUsers.find(user => user.name === welcomeText);
                const sellerName = currentUser ? currentUser.name : "Demo User";

                const newListing = {
                    id: listingsData.length + 1,
                    title: document.getElementById('listing-title').value,
                    price: parseFloat(document.getElementById('listing-price').value),
                    category: document.getElementById('listing-category').value,
                    location: document.getElementById('listing-location').value,
                    image: `https://placehold.co/600x400/777/FFFFFF?text=New+Item`,
                    description: document.getElementById('listing-description').value || "No description provided.",
                    seller: sellerName // Assign the logged-in user as the seller
                };
                listingsData.unshift(newListing); // Add to the beginning of the list
                applyFilters();
                modals.create.style.display = 'none';
                createListingForm.reset();
            });

            // --- 5. (Simulated) CHAT ---
            const chatForm = document.getElementById('chat-form');
            const chatInput = document.getElementById('chat-message-input');
            const chatWindow = document.getElementById('chat-window');
            chatForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const msgText = chatInput.value;
                if (!msgText.trim()) return;
                const msgDiv = document.createElement('div');
                msgDiv.classList.add('msg', 'msg-buyer');
                msgDiv.innerText = msgText;
                chatWindow.appendChild(msgDiv);
                chatWindow.scrollTop = chatWindow.scrollHeight;
                chatInput.value = '';
            });

            // --- 6. DEMO LOGIN/REGISTER LOGIC ---
            const loginForm = document.getElementById('login-form');
            const loginEmailInput = document.getElementById('login-email');
            const loginErrorMsg = document.getElementById('login-error-msg');
            const navLoggedIn = document.getElementById('nav-logged-in');
            const navLoggedOut = document.getElementById('nav-logged-out');
            const welcomeMsg = document.getElementById('welcome-msg');
            const logoutBtn = document.getElementById('logout-btn');
            const demoLoginBtn = document.getElementById('demo-login-btn'); 

            // NEW: Register Form elements
            const registerForm = document.getElementById('register-form');
            const registerNameInput = document.getElementById('register-name');
            const registerEmailInput = document.getElementById('register-email');
            const registerPasswordInput = document.getElementById('register-password');
            const registerConfirmPasswordInput = document.getElementById('register-confirm-password');
            const registerErrorMsg = document.getElementById('register-error-msg');

            // NEW: Auth Tab elements
            const loginTabBtn = document.getElementById('login-tab-btn');
            const registerTabBtn = document.getElementById('register-tab-btn');
            const loginFormContainer = document.getElementById('login-form-container');
            const registerFormContainer = document.getElementById('register-form-container');
            const authModalTitle = document.getElementById('auth-modal-title');

            loginTabBtn.addEventListener('click', () => {
                loginTabBtn.classList.add('active');
                registerTabBtn.classList.remove('active');
                loginFormContainer.classList.add('active');
                registerFormContainer.classList.remove('active');
                authModalTitle.innerText = "Login";
            });

            registerTabBtn.addEventListener('click', () => {
                loginTabBtn.classList.remove('active');
                registerTabBtn.classList.add('active');
                loginFormContainer.classList.remove('active');
                registerFormContainer.classList.add('active');
                authModalTitle.innerText = "Register";
            });

            function handleLoginSuccess(user) {
                isLoggedIn = true;
                navLoggedOut.style.display = 'none';
                navLoggedIn.style.display = 'flex';
                welcomeMsg.innerText = `Welcome, ${user.name}!`; 
                modals.login.style.display = 'none';
                loginForm.reset();
                registerForm.reset();
                loginErrorMsg.style.display = 'none';
                registerErrorMsg.style.display = 'none';
                savedItems.clear(); 
                updateSavedCount(); 
            }

            loginForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const email = loginEmailInput.value;
                const demoUser = demoUsers.find(user => user.email === email);
                if (demoUser) { handleLoginSuccess(demoUser); } 
                else { loginErrorMsg.style.display = 'block'; }
            });
            
            // NEW: Register Form Submit
            registerForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const name = registerNameInput.value;
                const email = registerEmailInput.value;
                const password = registerPasswordInput.value;
                const confirmPassword = registerConfirmPasswordInput.value;

                if (password !== confirmPassword) {
                    registerErrorMsg.innerText = "Passwords do not match.";
                    registerErrorMsg.style.display = 'block';
                    return;
                }
                
                // Check if user already exists
                if (demoUsers.find(user => user.email === email)) {
                     registerErrorMsg.innerText = "An account with this email already exists.";
                     registerErrorMsg.style.display = 'block';
                     return;
                }

                // Create and add new user
                const newUser = { email: email, name: name };
                demoUsers.push(newUser);
                
                // Automatically log in the new user
                handleLoginSuccess(newUser);
            });


            demoLoginBtn.addEventListener('click', () => {
                const firstDemoUser = demoUsers[0]; 
                handleLoginSuccess(firstDemoUser);
            });

            logoutBtn.addEventListener('click', () => {
                isLoggedIn = false;
                navLoggedOut.style.display = 'flex';
                navLoggedIn.style.display = 'none';
                savedItems.clear(); 
                updateSavedCount(); 
                // Reset any open detail modals to default state
                const allSaveBtns = document.querySelectorAll('#detail-modal-save-btn');
                allSaveBtns.forEach(btn => {
                    btn.innerText = 'Save for Later';
                    btn.classList.remove('btn-success');
                    btn.classList.add('btn-secondary');
                    btn.disabled = false;
                });
            });

            // --- 7. SAVE FOR LATER FUNCTIONALITY ---
            const savedItemsBtn = document.getElementById('saved-items-btn'); 

            function updateSavedCount() {
                savedItemsBtn.innerHTML = `&#9829; Saved (${savedItems.size})`;
            }

            function showToast(message) {
                toast.innerText = message;
                toast.style.display = 'block';
                setTimeout(() => {
                    toast.style.display = 'none';
                }, 3000); 
            }

            detailSaveBtn.addEventListener('click', () => {
                if (!isLoggedIn) {
                    modals.detail.style.display = 'none';
                    modals.login.style.display = 'block';
                    return;
                }

                const listingId = parseInt(detailSaveBtn.dataset.listingId);
                if (listingId) {
                    savedItems.add(listingId);
                    
                    detailSaveBtn.innerText = 'âœ“ Saved';
                    detailSaveBtn.classList.add('btn-success');
                    detailSaveBtn.classList.remove('btn-secondary');
                    detailSaveBtn.disabled = true;

                    updateSavedCount(); 
                    showToast("Item saved for later!"); 
                }
            });

            // --- 8. SAVED ITEMS MODAL LOGIC ---
            const savedItemsGrid = document.getElementById('saved-items-grid');

            function renderSavedItems() {
                if (savedItems.size === 0) {
                    savedItemsGrid.innerHTML = '<p class="saved-item-empty">You have no saved items.</p>';
                    return;
                }

                savedItemsGrid.innerHTML = ''; // Clear the grid
                
                const savedListings = listingsData.filter(listing => savedItems.has(listing.id));
                
                savedListings.forEach(listing => {
                    const itemHTML = `
                        <div class="saved-item-card" data-listing-id="${listing.id}">
                            <img src="${listing.image.replace('600x400', '100x100')}" alt="${listing.title}" class="saved-item-img">
                            <div class="saved-item-info">
                                <div class="saved-item-title">${listing.title}</div>
                                <div class="saved-item-price">&#8377;${listing.price}</div>
                            </div>
                        </div>
                    `;
                    savedItemsGrid.innerHTML += itemHTML;
                });
            }

            savedItemsBtn.addEventListener('click', () => {
                if (isLoggedIn) {
                    renderSavedItems(); // Re-render the list every time it's opened
                    modals.saved.style.display = 'block';
                }
            });
            
            savedItemsGrid.addEventListener('click', (e) => {
                const card = e.target.closest('.saved-item-card');
                if (card) {
                    const listingId = card.dataset.listingId;
                    modals.saved.style.display = 'none'; // Close saved modal
                    showDetailModal(listingId); // Show detail modal
                }
            });


            // --- Initial Render on Page Load ---
            renderListings(listingsData);

        });
    </script>

</body>
</html>
